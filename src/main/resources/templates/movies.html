<!doctype html>
<html lang="ro" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Movies • Cinema')}"></head>
<body>

<!-- NAVBAR -->
<div th:replace="~{fragments/navbar :: navbar('movies')}"></div>

<main class="container py-4 py-md-5">

    <div class="d-flex align-items-end justify-content-between flex-wrap gap-2 mb-4">
        <div>
            <h1 class="text-light mb-1">Movies</h1>
            <div style="color: var(--muted);">Alege un film și intră pe detalii.</div>
        </div>
        <a class="btn btn-outline-light" th:href="@{/}">← Home</a>
    </div>

    <form th:action="@{/movies}" method="get" class="d-flex gap-2 align-items-center mb-3">

        <!-- păstrează search-ul când schimbi genul -->
        <input type="hidden" name="search" th:value="${search}">
        <input type="hidden" name="date" th:value="${selectedDate}">

        <select class="form-select form-select-sm" name="genre" onchange="this.form.submit()">
            <option value="" th:selected="${genre == null or #strings.isEmpty(genre)}">Toate genurile</option>

            <option th:each="g : ${genres}"
                    th:value="${g}"
                    th:text="${g}"
                    th:selected="${g == genre}">
            </option>
        </select>

        <noscript>
            <button class="btn btn-outline-light btn-sm">Filtrează</button>
        </noscript>
    </form>


    <div class="row g-4">

        <!-- MOVIE CARD -->
        <div class="col-md-6 col-lg-3" th:each="m : ${movies}">
        <div class="card h-100 overflow-hidden">

                <!-- POSTER -->
            <div class="poster-box">
                <img class="poster-img"
                     th:src="@{/img/movies/{file}(file=${#strings.isEmpty(m.imageUrl) ? 'no-poster.png' : m.imageUrl})}"
                     alt="Movie poster"
                     onerror="this.onerror=null; this.src='/img/movies/no-poster.png';">
            </div>


            <!-- CONTENT -->
                <div class="card-body d-flex flex-column">

                    <h5 class="card-title fw-semibold"
                        th:text="${m.title}">
                        Movie title
                    </h5>

                    <div class="d-flex gap-2 flex-wrap mb-2" style="color: var(--muted);">
                        <span class="badge badge-soft">⭐ <span th:text="${m.rating}">0</span></span>
                        <span class="badge badge-soft"><span th:text="${m.duration}">0</span> min</span>
                        <span class="badge badge-soft"><span th:text="${m.genre}">Genre</span></span>
                    </div>

                    <div class="fw-semibold mb-3" th:text="${m.basePrice} + ' lei'">0 lei</div>

                    <a class="btn btn-outline-light mt-auto"
                       th:href="@{/movies/{id}(id=${m.idMovie})}">
                        Details
                    </a>
                </div>
            </div>
        </div>

        <!-- EMPTY STATE -->
        <div th:if="${#lists.isEmpty(movies)}" class="text-center" style="color: var(--muted); padding: 3rem 0;">
            No movies available.
        </div>

    </div>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>
<div th:replace="~{fragments/scripts :: scripts}"></div>

</body>
</html>
